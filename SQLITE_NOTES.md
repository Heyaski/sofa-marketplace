# Примечания по использованию SQLite в продакшене

## Преимущества SQLite

- ✅ Не требует отдельной установки и настройки
- ✅ Простота в использовании - один файл базы данных
- ✅ Отлично подходит для небольших и средних проектов
- ✅ Низкие требования к ресурсам
- ✅ Встроен в Python, не требует дополнительных зависимостей

## Ограничения SQLite

- ⚠️ Ограниченная поддержка одновременных записей (write concurrency)
- ⚠️ Не рекомендуется для высоконагруженных приложений (>100 одновременных пользователей)
- ⚠️ Нет встроенной поддержки репликации
- ⚠️ Ограничения по размеру базы данных (практически до 281 TB, но рекомендуется до 100 GB)

## Рекомендации для продакшена

### Когда использовать SQLite:

- Небольшие и средние проекты
- До 100 одновременных пользователей
- Низкая или средняя нагрузка на запись
- Проекты с ограниченным бюджетом
- Прототипы и MVP

### Когда переходить на PostgreSQL:

- Высокая нагрузка (>100 одновременных пользователей)
- Много одновременных записей в БД
- Требуется репликация и масштабирование
- Сложные запросы и транзакции
- Критически важные приложения

## Настройка для продакшена

### Права доступа к файлу БД

```bash
# Убедитесь, что у пользователя есть права на запись
sudo chown deploy:deploy ~/sofa-marketplace/backend/db.sqlite3
sudo chmod 664 ~/sofa-marketplace/backend/db.sqlite3

# Убедитесь, что директория доступна для записи
sudo chown -R deploy:deploy ~/sofa-marketplace/backend/
```

### Резервное копирование

SQLite - это один файл, поэтому бэкап очень простой:

```bash
# Простое копирование файла
cp ~/sofa-marketplace/backend/db.sqlite3 ~/backups/db_$(date +%Y%m%d).sqlite3

# Или используйте скрипт
bash deploy/backup.sh
```

### Оптимизация производительности

В `settings.py` можно добавить настройки для оптимизации:

```python
DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.sqlite3",
        "NAME": BASE_DIR / "db.sqlite3",
        "OPTIONS": {
            "timeout": 20,  # Таймаут для блокировок
        }
    }
}
```

### Мониторинг размера БД

```bash
# Проверка размера базы данных
ls -lh ~/sofa-marketplace/backend/db.sqlite3

# Если БД слишком большая, можно выполнить оптимизацию
sqlite3 ~/sofa-marketplace/backend/db.sqlite3 "VACUUM;"
```

## Миграция на PostgreSQL (если понадобится)

Если в будущем потребуется перейти на PostgreSQL:

1. Установите PostgreSQL на сервере
2. Создайте новую базу данных
3. Обновите `settings.py` для использования PostgreSQL
4. Выполните миграции: `python manage.py migrate`
5. Экспортируйте данные из SQLite и импортируйте в PostgreSQL (используйте `django-dbbackup` или ручной экспорт)

## Заключение

SQLite - отличный выбор для начала, особенно для небольших проектов. Он прост в настройке и не требует дополнительных ресурсов. Если проект вырастет, всегда можно мигрировать на PostgreSQL.
